\documentclass[a4paper,12pt]{article}
\usepackage{mathtext}
\usepackage[T2A]{fontenc}
\usepackage[koi8-r]{inputenc}
\usepackage[russian]{babel}
\usepackage{array}
\usepackage{tabularx}
\usepackage{longtable}
\usepackage[justification=centering]{caption}
\usepackage{indentfirst}
\usepackage[pdftex]{graphicx,color}
\usepackage{textcomp}
\usepackage{gnuplot-lua-tikz}
\usepackage{tikz}
\usepackage{amssymb}
\usepackage{amsmath}
% \usepackage{mathptm}

\setlength{\topmargin} {-1.5in}
\addtolength{\topmargin} {20mm}
\setlength{\oddsidemargin} {-1in}
\addtolength{\oddsidemargin} {30mm}
\textheight255mm
\textwidth165mm

% \renewcommand{\captionlabeldelim} {.}

\makeatletter
\renewcommand\@biblabel[1]{#1.}
\makeatother

\unitlength=1mm

\usepackage{listings} %% собственно, это и есть пакет listings
% \usepackage{caption}
\DeclareCaptionFont{white}{\color{white}} %% это сделает текст заголовка белым
%% код ниже нарисует серую рамочку вокруг заголовка кода.
\DeclareCaptionFormat{listing}{\colorbox{white}{\parbox{\textwidth}{#1#2#3}}}
% \captionsetup[lstlisting]{format=listing,labelfont=black,textfont=black}
\renewcommand{\lstlistingname}{Листинг}


\begin{document}


\usetikzlibrary{arrows}

\lstset{ %
 language=Bash,                 % выбор языка для подсветки (здесь это С)
 basicstyle=\small\ttfamily, % размер и начертание шрифта для подсветки кода
 numbers=left,               % где поставить нумерацию строк (слева\справа)
 numberstyle=\tiny,           % размер шрифта для номеров строк
 stepnumber=1,                   % размер шага между двумя номерами строк
 numbersep=5pt,                % как далеко отстоят номера строк от
 % подсвечиваемого кода
 backgroundcolor=\color{white}, % цвет фона подсветки - используем
 showspaces=false,            % показывать или нет пробелы специальными
% отступами
 showstringspaces=false,      % показывать или нет пробелы в строках
 showtabs=false,             % показывать или нет табуляцию в строках
 frame=single,              % рисовать рамку вокруг кода
 tabsize=2,                 % размер табуляции по умолчанию равен 2 пробелам
 captionpos=t,              % позиция заголовка вверху [t] или внизу [b] 
 breaklines=true,           % автоматически переносить строки (да\нет)
% wordwrap=true,
 breakatwhitespace=false, % переносить строки только если есть пробел
 escapeinside={\%*}{*)}   % если нужно добавить комментарии в коде
 }



\author{Кузнецов В.В., ассистент кафедры ЭИУ1-КФ}
\title{Семинар \No 3 по курсу <<Основы цифровой обработки сигналов>> \\
Быстрое преобразование Фурье}
\maketitle
 
Целью семинара является вычисление дискретного преобразования Фурье (ДПФ). 

Преобразование Фурье нельзя применить к дискретным сигналам. Для спектрального
анализа дискретного (и цифрового) сигнала служит \emph{дискретное
преобразование Фурье --- ДПФ}.

Предположим, что сигнал дискретизирован через равные промежутки времени $T$ и в
результате получена дискретная последовательность из $N$ выборок:
$${x(nT)=x(0),x(T),...,x[(N-1)T]}$$

где $n$ ---  номер выборки, который принимает значения от $n=0$ до $n=N-1$.

Значения $x(nT)$ будут действительными только тогда, когда они представляют
собой значения такого временного ряда как спектр напряжения. В подобном случае
ДПФ последовательности $x(nT)$ можно определить как последовательность
комплексных значений в частотной области:
\begin{equation}
 {X(k\Omega)}=X(0),X(\Omega),\ldots,X[(N-1)\Omega]
\end{equation}

Где $\Omega$ --- частота первой гармоники (при $N\gg 1$), она задаётся как
$1/N$ доля частоты дискретизации:
\begin{equation}
 \Omega=\frac{2\pi}{(N-1)T}\approx \frac{2\pi}{NT}
\end{equation}

Значения ДПФ задаются как:
\begin{equation}
 X(k)=\frac{1}{N} \sum_{n=0}^{N-1} x(nT) e^{-jk\Omega
nT}=\frac{1}{N}\sum_{n=0}^{N-1} x(nT) e^{-jk \frac{2\pi n}{N}},\qquad
k=0,1,\ldots,N-1 \label{DFT}
\end{equation}

Данное выражение называется \emph{прямым ДПФ}. ДПФ обозначается
как $F_D$. Последовательность из $N$ действительных значений во временной
области преобразуется в последовательность из $N$ комплексных значений в
частотной
области. 

Обычно под записью $x(n)$ подразумевают запись $x(nT)$, тем самым переходя к
безразмерной частоте дискретизации. ДПФ тогда запишется в виде:
\begin{equation}
 X(k)=F_D[x(n)]=\frac{1}{N}\sum_{n=0}^{N-1} x(n) e^{-jk \frac{2\pi n}{N}} 
\end{equation}


ДПФ связано со спектром сигнала. Его сравнение с преобразованием Фурье
 показывает, что ДПФ от сигнала $s(t)$ представляет собой отсчёты спектра
$S(\omega)$ этого дискретного сигнала, соответствующие частотам $\omega=\omega_д
k/N$, которые представляют собой доли от частоты дискретизации $\omega_д$.
\begin{equation}
 X(k)=S\left(\frac{2\pi k}{NT}\right)=S\left(\frac{\omega_д n}{N}\right)
\end{equation}

Поэтому ДПФ иногда называют \emph{спектральными отсчётами}. Из данного
соотношения следует вывод, что если добавить к конечному набору отсчётов
некоторое количество нулей, то спектр дискретного сигнала не изменится, но ДПФ
даст больше спектральных отсчётов. Эти отсчёты будут более тесно расположены по
оси частот в интервале от нуля до частоты дискретизации.

Таким образом ДПФ позволяет осуществлять спектральный анализ дискретных сигналов
на ЭВМ и реализовывать, например, цифровой анализатор спектра.

Рассмотрим пример вычисления ДПФ вручную. Найдём ДПФ $F_D[x(n)]$ сигнала,
заданного шестью $N=6$
отсчётами $x(n)=(1,1,1,0,0,0)$. Исходный сигнал показан на
рис.\ref{DFT-beispiel}:
\begin{figure}[!ht]
\begin{center}
\begin{tikzpicture}
\draw[-latex](-5mm,0)--(70mm,0) node [anchor=west]{$n$};
\foreach \t / \n / \x / \y in
{0mm/0/1/25mm,10mm/1/1/25mm,20mm/2/1/25mm,30mm/3/0/0mm,40mm/4/0/0mm,50mm/5/0/0mm
}
{
\draw (\t,0mm) node [anchor=north] {\n}--(\t,\y) node [anchor=south] {\x};
\fill (\t,\y) circle (0.7mm);
} 
\end{tikzpicture} 
\end{center}
\caption{Пример дискретного сигнала для вычисления ДПФ.}\label{DFT-beispiel}
\end{figure}


 По выражению (\ref{DFT}) найдём коэффициенты ДПФ для данного сигнала.
$$X(0)=\frac{1}{6}(1+1+1+0+0+0)=\frac{1}{2}$$
$$X(1)=\frac{1}{6}(1+e^{-j\pi/3}+e^{-j2\pi/3}+0+0+0)=\frac{1-j\sqrt{3}}{6}$$
$$X(2)=\frac{1}{6}(1+e^{-j2\pi/3}+e^{-j4\pi/3}+0+0+0)=0$$
$$X(3)=\frac{1}{6}(1+e^{-j3\pi/3}+e^{-j6\pi/3})=\frac{1}{6}$$

Последующие коэффициенты находятся на основании свойства симметричности:
$$X(4)=X^*(2)=0\qquad X(5)=X^*(1)=\frac{1-j\sqrt{3}}{6}$$

Коэффициент $X(0)$ равен постоянной составляющей (среднему значению) сигнала.

Для того чтобы выполнить дискретное преобразование из частотной области во
временную используется \emph{Обратное дискретное преобразование Фурье ---
ОДПФ}. ОДПФ обозначается символом $F_D^{-1}[]$. Оно определяется по следующему
выражению:

\begin{equation}
 x(nT)=F_D^{-1}[X(k)]=\sum_{k=0}^{N-1}X(k)e^{jk\Omega n
T}=\sum_{k=0}^{N-1}X(k)e^{jk\frac
{2\pi}{N}} \label{invDFT}
\end{equation}

Видно, что данное выражение совпадает с выражением для прямого ДПФ с точностью
до постоянного множителя и отличается от него знаком показателя экспоненты.
Следовательно, для вычисления прямого и обратного ДПФ на ЭВМ может быть
использован один и тот же алгоритм.

Обратное ДПФ по аналогии с обратным преобразованием Фурье позволяет переходить
от спектра к сигналу. По спектральным отсчётам можно восстановить исходный
сигнал. Например ОДПФ позволяет вычислять круговую свёртку на основании
произведений ДПФ сигналов:
\begin{equation}
 f(n)=x(n)\circledast y(n)=F_D^{-1}[X(k)\cdot Y(k)]
\end{equation}

Такой способ вычисления даёт экономию машинных ресурсов по сравнению с прямым
вычислением круговой свёртки, так как при этом выполняется меньше операций.


Если известна последовательность коэффициентов ДПФ $X(k)$, которая была найдена
по последовательности отсчётов $x(n)$, то по ним может быть найден исходный
сигнал $x(t)$, который был подвергнут дискретизации. Ряд Фурье такого сигнала
из $N$ отсчётов принимает вид с учётом свойства симметричности:
\begin{equation}
\begin{split}
 x(t)=X(0)+2|X(1)|\cos(2\pi t/NT+\varphi_1)+2|X(2)|\cos(4\pi
t/NT+\varphi_2)+\ldots+\\
+|X(N/2)|\cos(N\pi t/NT+\varphi_{N/2})
\end{split}
\end{equation}
где $\varphi_i=\mbox{arg}X(i)$ --- фазовый угол коэффициента ДПФ. В качестве
примера рассмотрим сигнал восстановленный по отсчётам по данным примера
рис.\ref{DFT-beispiel}:
\begin{equation}
 x(t)=\frac{1}{2}+\frac{2}{3}\cos(\frac{\pi
t}{3T}-\frac{\pi}{3})+\frac{1}{6}\cos(\frac{\pi t}{T})
\end{equation}

Осциллограмма восстановленного сигнала показана на рис.\ref{DFT-osc}.
\begin{figure}[!ht]
\begin{center}
\begin{tikzpicture}
\draw [-latex] (0,0)--(80mm,0) node [anchor=west]{$t/NT$};
\draw [-latex] (0,0)--(0mm,30mm) node [anchor=south] {$x(t)$};
\draw [thick, x=0.02cm, y=2.5cm, declare function={
s1(\t)=0.5+0.666*cos(\t-60)+0.1667*cos(3*\t);
}]
plot [domain=0:360, samples=144, smooth] (\x,{s1(\x)}); 
\draw (0,12.5mm) node[anchor=east]{0.5} -- (2.5mm,12.5mm);
\draw (0,25mm) node[anchor=east]{1.0} -- (2.5mm,25mm);
\draw (36mm,0mm) node[anchor=north]{0.5} -- (36mm,2.5mm);
\draw (72mm,0mm) node[anchor=north]{1.0} -- (72mm,2.5mm);
\end{tikzpicture} 
\end{center}
\caption{Сигнал, восстановленный по коэффициентам ДПФ.}\label{DFT-osc}
\end{figure}

Реализация БПФ на современных ЭВМ имеет свои особенности. Для этого
используются или среды численной математики подобные MATLAB (GNU/Octave), или
реализация на языке С/C++ при помощи библиотек, подобных \verb|libfftw3|.

Рассмотрим пример реализации ДПФ в среде численной математики GNU/Octave.
Для вычисления ДПФ сигнала служит функция \verb|fft|. В качестве параметра на
вход функции нужно передать вектор, содержащий отсчёты сигнала. Вторым
параметром функции служит число отсчётов ДПФ. Этот параметр может отсутствовать.


Пример скрипта для реализации ДПФ суммы двух синусоидальных сигналов приведён в
листинге \ref{FFT-octave}. Скрипт строит графики двухтонального сигнала с
постоянной составляющей и его спектра. На рис.\ref{FFT-octave-erg} показан
результат выполнения скрипта.

\lstset{language=Bash}
\begin{lstlisting}[caption=Скрипт на GNU/Octave для реализации построения
вычисления спектра сигнала., label=FFT-octave ]
#!/usr/bin/octave -qf
Ns=1000; # число отсчётов сигнала
F1=100; # частота первого тона 100 Гц
F2=200; # частота второго тона 200 гц
dur=0.5; # длительность сигнала 0.5 сек
A0=0.6; # постоянная составляющая 0.6 В
A1=0.8; # амплиткда первого тона 0.8 В
A2=1.4; # амплитуда второго тона 1.4В
An=6; # амплитуда шума 6 В
Fs=Ns/dur; # частота дисктеризации. Делим число выборок 
# на длительность сигнала.
t=(0:dur/Ns:dur)'; # создаём вектор из 2000 отсчёов по вермени
Signal=A0 + A1*sin(2*pi*F1*t) + A2*sin(2*pi*F2*t); # сигнал
# Сигнал состоит из постоянной составляющей и двух тонов амплитудой
# А1 и A2
S=fft(Signal); # вычисляем ДПФ, то есть спектр
F=0:(Fs/Ns):Fs; # частота
subplot(2,1,1); 
plot(t,Signal); # строим график сигнала
subplot(2,1,2);
plot(F,abs(S)); # строим график спектра
pause; 
\end{lstlisting}

\begin{figure}[!ht]
\input{../DSP/Spectrum1.tex}
\caption{Результат применения функции fft к двухтональному
сигналу} \label{FFT-octave-erg}
\end{figure}

Из рисунка видим, что спектр сигнала состоит из двух зеркальных половинок.
Правая часть спектра в интервале частот от $F_s/2$ до $F_s$ соответствуют
отрицательным частотам, которые не имеют физического смысла. И эта часть
спектра никакой дополнительной информации о сигнале не несёт. Поэтому её можно
отбросить. Амплитуды гармоник распределяются по двум половинам спектра и каждую
амплитуду, кроме постоянной составляющей соответствующей нулевой частоте, после
отбрасывания половины спектра нужно умножить в два раза.

Как видно из определения ДПФ (\ref{DFT}), при вычислении ДПФ происходит
суммирование всех отсчётов сигналов, поэтому амплитуды получившихся гармоник
будут в $N$ (число отсчётов сигнала) раз больше, чем составляющих исходного
спектра. Поэтому амплитуду каждой из гармоник нужно разделить на $N$.

Вышеизложенные операции называются нормировкой результата ДПФ. Нормировка
повышает наглядность представления спектра. После нормировки видно, из каких
амплитуд состоит сигнал. Скрипт для нормировки ДПФ из предыдущего примера
приведён в листинге \ref{FFT-norm}, результат выполнения скрипта показан на
рис.\ref{FFT-norm-erg}.

\lstset{language=Bash}
\begin{lstlisting}[caption=Скрипт на GNU/Octave для реализации построения
вычисления спектра сигнала., label=FFT-norm ]
#!/usr/bin/octave -qf
pkg load signal
Ns=1000; # число отсчётов сигнала
F1=100; # частота первого тона 100 Гц
F2=200; # частота второго тона 200 гц
dur=0.5; # длительность сигнала 0.5 сек
A0=0.6; # постоянная составляющая 0.6 В
A1=0.8; # амплиткда первого тона 0.8 В
A2=1.4; # амплитуда второго тона 1.4В
An=6; # амплитуда шума 6 В
Fs=Ns/dur; # частота дискретизации. Делим число выборок 
# на длительность сигнала.
t=(0:dur/Ns:dur)'; # создаём вектор из 2000 отсчёов по вермени
Signal=A0 + A1*sin(2*pi*F1*t) + A2*sin(2*pi*F2*t); # сигнал
# Сишнал состоит из постоянной составляющей и двух тонов амплитудой
# А1 и A2
S=fft(Signal); # вычисляем ДПФ, то есть спектр
S=(2/Ns)*abs(S(1:Ns/2)); # отсекаем половину спектра, которая не несёт полезной
информации
S(1)=0.5*S(1); # нормируем постоянную составляющую
F=0:(Fs/Ns):Fs-1; # частота
F=F(1:(length(F)/2)); # отсекаем половину частоты

subplot(2,1,1); 
plot(t,Signal); # строим график сигнала
subplot(2,1,2);
plot(F,abs(S)); # строим график спектра
axis([0,300]);

pause;
\end{lstlisting}

\begin{figure}[!ht]
\input{../DSP/Spectrum2.tex}
\caption{Нормировка результата применения функции fft к двухтональному
сигналу} \label{FFT-norm-erg}
\end{figure}

Из рисунка видно, что спектр состоит из трёх пиков. Первый пик расположен на
частоте $f=0$ и имеет амплитуду 0,6 В. Он соответствует постоянной
составляющей. Второй пик расположен на частоте 100 Гц и имеет амплитуду 0,8 В.
Он соответствует первому тону частотой 100 Гц. Третий пик расположен на частоте
200 Гц и имеет амплитуду 1,4 В. Он соответствует второму тону частотой 200 Гц.
Таким образом на спектре видим, что сигнал состоит из двух синусоидальных
сигналов и постоянной составляющей. 

\end{document}
